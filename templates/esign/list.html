{% extends "base.html" %}{% load static %}

{% block html_title %}Главная{% endblock %}
{% block html_head %}
    <link rel='stylesheet' href='{% static "css/main.css" %}' type='text/css' />
{% endblock %}
{% block html_body %}
    <main role="main" class="container-fluid">
        <div class="row">
            <div class="col-auto mr-auto">
                <nav aria-label="breadcrumb">
                    <ol class="breadcrumb">
                        <li class="breadcrumb-item"><a href="{% url 'index' %}">Главная</a></li>
                        <li class="breadcrumb-item active" aria-current="page">Список электронных подписей</li>
                    </ol>
                </nav>
            </div>
            <div class="col-auto mr-0 text-right">
                {% if current_user.access.esign_edit %}
                    <button type="button" class="btn btn-outline-primary" data-toggle="modal" data-target="#ModalSignAdd" title="Добавить нового файл электронной подписи"><i class="fas fa-file-signature"></i> Добавить</button>
                {% endif %}
            </div>
        </div>
        {% for esign in esign_list %}
            {{ esign.id }} - {{ esign.entity }} - {{ esign.valid_from }} - {{ esign.valid_for }}<br />
        {% endfor %}
        <h3>Список электронных подписей:</h3>
        <ul class="nav nav-pills mb-3" id="pills-tab" role="tablist">
            <li class="nav-item">
                <a class="nav-link active" id="pills-current-tab" data-toggle="pill" href="#pills-current" role="tab" aria-controls="pills-current" aria-selected="true">
                    Действующие <span class="badge badge-secondary">{{ esign_count_current }}</span>
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link" id="pills-extended-tab" data-toggle="pill" href="#pills-extended" role="tab" aria-controls="pills-extended" aria-selected="false">
                    Продленные <span class="badge badge-secondary">{{ esign_count_extended }}</span>
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link" id="pills-expires-tab" data-toggle="pill" href="#pills-expires" role="tab" aria-controls="pills-expires" aria-selected="false">
                    Истекшие <span class="badge badge-secondary">{{ esign_count_expires }}</span>
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link" id="pills-terminate-tab" data-toggle="pill" href="#pills-terminate" role="tab" aria-controls="pills-terminate" aria-selected="false">
                    Аннулированные <span class="badge badge-secondary">{{ esign_count_terminate }}</span>
                </a>
            </li>
        </ul>
        <div class="tab-content" id="pills-tabContent">
            <div class="tab-pane fade show active" id="pills-current" role="tabpanel" aria-labelledby="pills-current-tab">
                <table class="table table-hover table-sm">
                    {% for esign in esign_list_current %}
                        <tr {% if esign.is_expires %}class="table-danger"{% endif %}>
                            <td>
                                {{ esign.entity }}
                            </td>
                            <td>
                                С {{ esign.valid_from|date:"d E Y" }} по {{ esign.valid_for|date:"d E Y" }}
                            </td>
                            <td>
                                <span title="{{ esign.owner.organization }}">{{ esign.owner.organization|truncatechars:40 }}</span>
                            </td>
                            {% if current_user.access.esign_edit and current_user.organization == esign.owner.organization %}
                                <td class="text-right ">
                                    <a href="{% url 'esign_show' esign.id %}" class="btn btn-outline-secondary" title="Перейти к сертификату"><i class="fas fa-file-contract"></i> Перейти к сертификату</a>
                                </td>
                            {% endif %}
                        </tr>
                    {% endfor %}
                </table>
            </div>
            <div class="tab-pane fade" id="pills-extended" role="tabpanel" aria-labelledby="pills-extended-tab">
                <table class="table table-hover table-sm">
                    {% for esign in esign_list_extended %}
                        <tr>
                            <td>
                                {{ esign.entity }}
                            </td>
                            <td>
                                С {{ esign.valid_from|date:"d E Y" }} по {{ esign.valid_for|date:"d E Y" }}
                            </td>
                            <td>
                                <span title="{{ esign.owner.organization }}">{{ esign.owner.organization|truncatechars:40 }}</span>
                            </td>
                            {% if current_user.access.esign_edit and current_user.organization == esign.owner.organization %}
                                <td class="text-right ">
                                    <a href="{% url 'esign_show' esign.id %}" class="btn btn-outline-secondary" title="Перейти к сертификату"><i class="fas fa-file-contract"></i> Перейти к сертификату</a>
                                </td>
                            {% endif %}
                        </tr>
                    {% endfor %}
                </table>
            </div>
            <div class="tab-pane fade" id="pills-expires" role="tabpanel" aria-labelledby="pills-expires-tab">
                <table class="table table-hover table-sm">
                    {% for esign in esign_list_expires %}
                        <tr>
                            <td>
                                {{ esign.entity }}
                            </td>
                            <td>
                                С {{ esign.valid_from|date:"d E Y" }} по {{ esign.valid_for|date:"d E Y" }}
                            </td>
                            <td>
                                <span title="{{ esign.owner.organization }}">{{ esign.owner.organization|truncatechars:40 }}</span>
                            </td>
                            {% if current_user.access.esign_edit and current_user.organization == esign.owner.organization %}
                                <td class="text-right ">
                                    <a href="{% url 'esign_show' esign.id %}" class="btn btn-outline-secondary" title="Перейти к сертификату"><i class="fas fa-file-contract"></i> Перейти к сертификату</a>
                                </td>
                            {% endif %}
                        </tr>
                    {% endfor %}
                </table>
            </div>
            <div class="tab-pane fade" id="pills-terminate" role="tabpanel" aria-labelledby="pills-terminate-tab">
                <table class="table table-hover table-sm">
                    {% for esign in esign_list_terminate %}
                        <tr>
                            <td>
                                {{ esign.entity }}
                            </td>
                            <td>
                                С {{ esign.valid_from|date:"d E Y" }} по {{ esign.valid_for|date:"d E Y" }}
                            </td>
                            <td>
                                <span title="{{ esign.owner.organization }}">{{ esign.owner.organization|truncatechars:40 }}</span>
                            </td>
                            {% if current_user.access.esign_edit and current_user.organization == esign.owner.organization %}
                                <td class="text-right ">
                                    <a href="{% url 'esign_show' esign.id %}" class="btn btn-outline-secondary" title="Перейти к сертификату"><i class="fas fa-file-contract"></i> Перейти к сертификату</a>
                                </td>
                            {% endif %}
                        </tr>
                    {% endfor %}
                </table>
            </div>
        </div>
    </main>
    {% if current_user.access.esign_edit %}
        <!-- Окно добавления фала электронной подписи -->
        <div class="modal fade" id="ModalSignAdd" tabindex="-1" role="dialog" aria-labelledby="ModalSignAddTitle" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered modal-lg" role="document">
                <div class="modal-content text-left">
                    <form method='post' action='{% url 'esign_list' %}' enctype='multipart/form-data'>
                        {% csrf_token %}
                        <div class="modal-header">
                            <h4 class="modal-title" id="ModalSignAddTitle">Добавление файла электронной подписи</h4>
                            <button type="button" class="close" data-dismiss="modal" aria-label="Закрыть"><span aria-hidden="true">&times;</span></button>
                        </div>
                        <div class="modal-body">
                            <div class="row">
                                <div class="col-md-12 mb-2">
                                    <h6>{{ form_upload.file.label }}:</h6>
                                    {{ form_upload.file }}
                                </div>
                            </div>
                            {% if esign_list_current %}
                                <div class="row">
                                    <div class="col-md-12 mb-2">
                                        <h6>{{ form_upload.select.label }}:</h6>
                                        {% for select in form_upload.select %}
                                            {{ select }}
                                        {% endfor %}
                                    </div>
                                </div>
                                <div class="row" id="renew_choice">
                                    <div class="col-md-12 mb-2">
                                        <h6>Выберите сертификат который продляется новым сертификатом:</h6>
                                        <select name="renew" class="custom-select">
                                            <option selected value="0">---</option>
                                            {% for esign in esign_list_current %}
                                                <option value="{{ esign.id }}">{{ esign.entity }} ({{ esign.valid_from|date:"d E Y" }} - {{ esign.valid_for|date:"d E Y" }})</option>
                                            {% endfor %}
                                        </select>
                                    </div>
                                </div>
                            {% endif %}
                        </div>
                        <div class="modal-footer">
                            <button class="btn btn-primary" type="submit">Добавить</button>
                            <button type="button" class="btn btn-secondary" data-dismiss="modal">Не добавлять</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
        <!-- /Окно добавления фала электронной подписи -->
        <script type="text/javascript">
            $(document).ready(function(){
                $('#renew_choice').hide();
            });
            $('input#id_select_0').click(function () {
                    $('#renew_choice').hide();
                }
            );
            $('input#id_select_1').click(function () {
                    $('#renew_choice').show();
                }
            );
        </script>
    {% endif %}
{% endblock %}
